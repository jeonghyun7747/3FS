# cmake 

ë¬¼ë¡ ì…ë‹ˆë‹¤! `CMake`ëŠ” C/C++ í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•˜ê¸° ìœ„í•œ ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤. ê°„ë‹¨í•œ ì‚¬ìš© ë°©ë²•ì„ ì•„ë˜ì— ì •ë¦¬í•´ë“œë¦´ê²Œìš”.

---

### ğŸ”§ ê¸°ë³¸ êµ¬ì¡°

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ì€ C++ í”„ë¡œì íŠ¸ê°€ ìˆë‹¤ê³  ê°€ì •í•˜ê² ìŠµë‹ˆë‹¤:

```
project/
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ main.cpp
```

#### ğŸ“„ main.cpp

```cpp
#include <iostream>

int main() {
    std::cout << "Hello, CMake!" << std::endl;
    return 0;
}
```

#### ğŸ“„ CMakeLists.txt

```cmake
cmake_minimum_required(VERSION 3.10)  # ìµœì†Œ CMake ë²„ì „
project(MyApp)                        # í”„ë¡œì íŠ¸ ì´ë¦„

set(CMAKE_CXX_STANDARD 17)            # C++17 ì‚¬ìš©

add_executable(MyApp main.cpp)        # ì‹¤í–‰ íŒŒì¼ ìƒì„±
```

---

### ğŸ§ª ë¹Œë“œ ë°©ë²•

í„°ë¯¸ë„ì—ì„œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™ í›„:

```bash
mkdir build
cd build
cmake ..      # CMake ì„¤ì • íŒŒì¼ ì½ê¸°
make          # ë¹Œë“œ (Makefile ê¸°ë°˜)
```

ë¹Œë“œ í›„ `build` ë””ë ‰í† ë¦¬ì— `MyApp` ì‹¤í–‰ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

---

### ğŸ“¦ ì¶”ê°€ ê¸°ëŠ¥ ì˜ˆì‹œ

#### ì—¬ëŸ¬ ì†ŒìŠ¤ íŒŒì¼ì´ ìˆëŠ” ê²½ìš°

```cmake
add_executable(MyApp main.cpp foo.cpp bar.cpp)
```

ë˜ëŠ” ì†ŒìŠ¤ íŒŒì¼ì„ ë³€ìˆ˜ë¡œ ì§€ì •:

```cmake
set(SOURCES main.cpp foo.cpp bar.cpp)
add_executable(MyApp ${SOURCES})
```

#### í—¤ë” íŒŒì¼ í¬í•¨ ê²½ë¡œ ì§€ì •

```cmake
include_directories(include)
```

#### ë¼ì´ë¸ŒëŸ¬ë¦¬ ë§í¬

```cmake
target_link_libraries(MyApp pthread)
```

---

í•„ìš”í•˜ì‹œë©´ `CMake`ë¥¼ ì´ìš©í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ í”„ë¡œì íŠ¸ ì„¤ì •ë²•ì´ë‚˜ í…ŒìŠ¤íŠ¸ ì„¤ì •ë²• ë“±ë„ ì¶”ê°€ë¡œ ì„¤ëª…ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


# target_add_bin(hf3fs_fuse_main hf3fs_fuse.cpp hf3fs_fuse) 
ì´ëŸ° ë‚´ìš©ì€ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëƒ?

`target_add_bin(hf3fs_fuse_main hf3fs_fuse.cpp hf3fs_fuse)` ì´ êµ¬ë¬¸ì€ **CMake ê¸°ë³¸ ë¬¸ë²•ì´ ì•„ë‹ˆë¼**, í”„ë¡œì íŠ¸ì—ì„œ ì •ì˜í•œ **ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜**ì¼ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. ì¦‰, `target_add_bin()`ì€ CMakeLists.txt ì–´ë”˜ê°€ ë˜ëŠ” `cmake/*.cmake` íŒŒì¼ ë“±ì—ì„œ `function(target_add_bin ...)` ìœ¼ë¡œ ì •ì˜ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### ğŸ‘€ ì¼ë°˜ì ì¸ CMake ìŠ¤íƒ€ì¼ë¡œ ìœ ì¶”í•´ ë³´ê¸°

ì´ ì¤„ì€ ëŒ€ì²´ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì˜ë¯¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```cmake
target_add_bin(<target_name> <source_file> <output_name>)
```

ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì€ ì˜ë¯¸ë¡œ í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* `hf3fs_fuse_main` : **íƒ€ê²Ÿ ì´ë¦„** (CMake ë‚´ë¶€ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì´ë¦„)
* `hf3fs_fuse.cpp` : **ì†ŒìŠ¤ ì½”ë“œ íŒŒì¼**
* `hf3fs_fuse` : **ë¹Œë“œëœ ë°”ì´ë„ˆë¦¬ì˜ ì´ë¦„**

---

### ğŸŸ© ë¹„ìŠ·í•œ ì¼ë°˜ CMake ë¬¸ë²•ìœ¼ë¡œ ë³€í™˜í•˜ë©´:

```cmake
add_executable(hf3fs_fuse_main hf3fs_fuse.cpp)
set_target_properties(hf3fs_fuse_main PROPERTIES OUTPUT_NAME "hf3fs_fuse")
```

ì´ë ‡ê²Œ í•˜ë©´:

* ë‚´ë¶€ì ìœ¼ë¡œëŠ” `hf3fs_fuse_main`ì´ë¼ëŠ” íƒ€ê²Ÿì´ì§€ë§Œ
* ì‹¤ì œë¡œ ìƒì„±ë˜ëŠ” ë°”ì´ë„ˆë¦¬ ì´ë¦„ì€ `hf3fs_fuse`ê°€ ë©ë‹ˆë‹¤.

---

### âœ… í™•ì¸ ë°©ë²•

1. `CMakeLists.txt` ìƒë‹¨ì´ë‚˜ `cmake/` ë””ë ‰í† ë¦¬ ë“±ì—ì„œ `target_add_bin` ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì°¾ìœ¼ì„¸ìš”.
2. ì•„ë§ˆ ë‹¤ìŒê³¼ ê°™ì€ ì‹ìœ¼ë¡œ ì •ì˜ë˜ì–´ ìˆì„ ê²ƒì…ë‹ˆë‹¤:

```cmake
function(target_add_bin TARGET_NAME SRC_FILE OUTPUT_NAME)
    add_executable(${TARGET_NAME} ${SRC_FILE})
    set_target_properties(${TARGET_NAME} PROPERTIES OUTPUT_NAME ${OUTPUT_NAME})
endfunction()
```

---

í•„ìš”í•˜ì‹œë©´ `target_add_bin` í•¨ìˆ˜ë¥¼ ë¶„ì„í•˜ê±°ë‚˜, ì´ë¥¼ ì¼ë°˜ CMake ë¬¸ë²•ìœ¼ë¡œ ë‹¤ì‹œ ì‘ì„±í•˜ëŠ” ê²ƒë„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.



### ë‹¤ìŒê³¼ ê°™ì´ macroì— ì •ì˜ ë˜ì–´ ìˆìŒ 

```sh
macro(target_add_bin NAME MAIN_FILE)
  add_executable(${NAME} ${MAIN_FILE})
    target_link_libraries(${NAME} ${ARGN} "")
    target_include_directories(${NAME}
        PUBLIC
            $<BUILD_INTERFACE:${PROJECT_SOURCE_DIR}/src>
            ${PROJECT_SOURCE_DIR}
            ${PROJECT_SOURCE_DIR}/src/lib/api
            ${PROJECT_BINARY_DIR}/src
            ${PROJECT_BINARY_DIR}
    )
    set_target_properties(${NAME} PROPERTIES RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin")
    target_enable_ipo(${NAME})
endmacro()
```